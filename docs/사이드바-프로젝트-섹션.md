# 사이드바 프로젝트 섹션

## 개요

사이드바의 프로젝트 섹션은 사용자가 생성한 프로젝트와 저장한 프로젝트를 통합하여 표시하는 컴포넌트입니다.

## 주요 기능

### 1. 통합된 프로젝트 목록 표시

- **내가 생성한 프로젝트**: 상단에 표시되며, 별 아이콘(⭐)으로 구분됩니다
  - 자동으로 북마크 테이블에 저장되며 해제할 수 없습니다
  - 생성일 최신순으로 정렬됩니다
- **내가 저장한 프로젝트**: 하단에 표시됩니다
  - 저장한 생성일 순으로 정렬됩니다

### 2. 헤더 네비게이션

- 헤더 클릭 시 `/bookmark/project` 페이지로 이동합니다
- 단일 헤더만 존재하여 간결한 UI를 제공합니다

### 3. 더 보기 기능

- 최대 15개까지 표시하며, 그 이상일 경우 "더 보기" 버튼이 표시됩니다
- "더 보기" 버튼 클릭 시 `/bookmark/project` 페이지로 이동합니다

## 컴포넌트 구조

### ProjectSection 컴포넌트

**위치**: `src/widgets/sidebar/ProjectSection.tsx`

**주요 기능**:
- 저장한 프로젝트 목록을 zustand store에서 가져옵니다
- 내가 생성한 프로젝트와 저장한 프로젝트를 구분하여 표시합니다
- 최대 15개까지 표시하고, 그 이상일 경우 더 보기 버튼을 표시합니다

**사용 예시**:
```tsx
import { ProjectSection } from "@/widgets/sidebar";

function Sidebar() {
  return (
    <aside>
      {/* 다른 섹션들 */}
      <ProjectSection />
    </aside>
  );
}
```

## 데이터베이스 구조

### 북마크 테이블

내가 생성한 프로젝트는 자동으로 `odd.tbl_project_bookmarks` 테이블에 저장됩니다.

**초기 설정 쿼리**: `docs/sql/040_upsert_my_projects_to_bookmarks.sql`
- 기존에 생성한 프로젝트를 북마크 테이블에 자동으로 추가합니다
- 한 번만 실행하면 됩니다

### SQL 함수

**함수**: `odd.v1_fetch_saved_projects`
- 내가 생성한 프로젝트와 저장한 프로젝트를 구분하여 반환합니다
- `is_my_project` 필드로 구분됩니다
- 내가 생성한 프로젝트는 생성일 최신순으로, 저장한 프로젝트는 저장일 순으로 정렬됩니다

**수정 쿼리**: `docs/sql/041_update_fetch_saved_projects.sql`

## API 구조

### fetchSavedProjects

**위치**: `src/entities/project/api/project.api.ts`

**반환 타입**:
```typescript
interface FetchSavedProjectsResult {
  projects: Project[];
  error: Error | null;
}
```

**Project 타입**:
```typescript
interface Project {
  // ... 기존 필드들
  isMyProject?: boolean; // 내가 생성한 프로젝트 여부
}
```

## 사용 흐름

1. **초기 로드**
   - 사용자가 로그인하면 `loadSavedProjects()`가 호출됩니다
   - 저장한 프로젝트 목록이 로드됩니다

2. **프로젝트 표시**
   - SQL 함수에서 이미 정렬된 순서대로 표시됩니다
   - 내가 생성한 프로젝트가 먼저 표시되고, 그 다음에 저장한 프로젝트가 표시됩니다

3. **프로젝트 클릭**
   - 프로젝트 항목 클릭 시 `/project/{projectId}` 페이지로 이동합니다

4. **더 보기**
   - 15개 초과 시 "더 보기" 버튼이 표시됩니다
   - 클릭 시 `/bookmark/project` 페이지로 이동합니다

## 스토리북

**위치**: `src/widgets/sidebar/__stories__/ProjectSection.stories.tsx`

**스토리 종류**:
- `Default`: 기본 상태 (내가 생성한 프로젝트 + 저장한 프로젝트)
- `OnlyMyProjects`: 내가 생성한 프로젝트만 있는 경우
- `OnlyBookmarkedProjects`: 저장한 프로젝트만 있는 경우
- `Empty`: 프로젝트가 없는 경우
- `Loading`: 로딩 중인 경우
- `ManyProjects`: 많은 프로젝트가 있는 경우 (더 보기 버튼 표시)
- `WithThumbnails`: 썸네일이 있는 프로젝트

## 관련 파일

- **컴포넌트**: `src/widgets/sidebar/ProjectSection.tsx`
- **스토리**: `src/widgets/sidebar/__stories__/ProjectSection.stories.tsx`
- **SQL 초기 설정**: `docs/sql/040_upsert_my_projects_to_bookmarks.sql`
- **SQL 함수 수정**: `docs/sql/041_update_fetch_saved_projects.sql`
- **API**: `src/entities/project/api/project.api.ts`
- **타입**: `src/entities/project/model/project.types.ts`
- **스토어**: `src/entities/project/model/project.store.ts`

## 실행 방법

### 1. SQL 쿼리 실행

먼저 내가 생성한 프로젝트를 북마크 테이블에 추가합니다:

```bash
psql "postgresql://postgres.xyqpggpilgcdsawuvpzn:ZNDqDunnaydr0aFQ@aws-0-ap-northeast-2.pooler.supabase.com:5432/postgres" -f docs/sql/040_upsert_my_projects_to_bookmarks.sql
```

### 2. SQL 함수 수정

저장한 프로젝트 조회 함수를 수정합니다:

```bash
psql "postgresql://postgres.xyqpggpilgcdsawuvpzn:ZNDqDunnaydr0aFQ@aws-0-ap-northeast-2.pooler.supabase.com:5432/postgres" -f docs/sql/041_update_fetch_saved_projects.sql
```

## 변경 사항

### 이전 구조

- 프로젝트 섹션과 내 프로젝트 섹션이 분리되어 있었습니다
- 두 개의 헤더가 존재했습니다

### 새로운 구조

- 단일 헤더로 통합되었습니다
- 내가 생성한 프로젝트와 저장한 프로젝트가 하나의 섹션에 통합되었습니다
- 내가 생성한 프로젝트는 자동으로 북마크 테이블에 저장되며 해제할 수 없습니다





