import { Meta, Canvas } from "@storybook/blocks";
import { CommentThread } from "./CommentThread";

<Meta title="Shared/UI/CommentThread/Docs" of={CommentThread} />

# CommentThread 사용 가이드

- **역할**: 피드/커뮤니티 전역에서 재사용 가능한 댓글 스레드 UI.
- **포인트**
  - 최근 댓글 우선 정렬 (각 뎁스 레벨마다 최신순)
  - 최대 뎁스/이미지 첨부 허용 여부/첨부 가능 개수 옵션화
  - 본인 댓글 인라인 수정/삭제 + 삭제 전 인라인 확인 UI
  - 입력창 단축키 안내: `⌘+Enter` 전송, `Esc` 취소 (포커스 시 강조)
  - 이미지 첨부 버튼에 `현재/최대` 첨부 가능 개수 표시, 비활성 시 툴팁 안내
  - 긴 댓글 접기/펼치기, 첨부 이미지 라이트박스

## Props 개요

- `comments: CommentNode[]` — 렌더링할 댓글 데이터 (replies 포함)
- `currentUser?: CommentAuthor` — 입력창 아바타/작성자 이름에 사용
- `currentUserId?: string` — 수정/삭제 권한 체크용 식별자
- `maxDepth?: number` — 허용할 최대 뎁스 (기본 3)
- `enableAttachments?: boolean` — 이미지 첨부 허용 여부 (기본 true)
- `maxImages?: number` — 첨부 가능 이미지 수 (기본 1)
- `onCreate(content, images)` — 루트 댓글 생성 핸들러 (동기/비동기 모두 지원)
- `onReply(parentId, content, images)` — 답글 생성 핸들러 (동기/비동기 모두 지원)
- `onEdit(commentId, content, images)` — 본인 댓글 수정 핸들러 (동기/비동기 모두 지원)
- `onDelete(commentId)` — 본인 댓글 소프트 삭제 핸들러 (동기/비동기 모두 지원)
- `onLike(commentId)` — 좋아요 토글 핸들러

## 예시 코드

```tsx
import { CommentThread, CommentNode } from "@/shared/ui/comment";

const comments: CommentNode[] = [...];

<CommentThread
  comments={comments}
  currentUser={{ id: "me", displayName: "나" }}
  currentUserId="me"
  maxDepth={3}
  enableAttachments
  maxImages={2}
  onCreate={handleCreate}
  onReply={handleReply}
  onLike={handleLike}
  onEdit={handleEdit}
  onDelete={handleDelete}
/>;
```

## UX 노트

- 삭제된 댓글은 본문을 회색 "삭제된 댓글입니다."로 대체하지만, 답글은 그대로 노출합니다.
- 이미지 업로드는 테두리/계수 표기로 눈에 띄게 하되 과도한 강조는 피했습니다.
- 입력창 단축키 안내를 입력 영역 바로 아래 배치하여 학습 비용을 최소화했습니다.
- 삭제 전 인라인 확인 UI로 오동작을 줄이고, 확인 중에는 카드 배경에 연한 붉은 틴트를 추가합니다.
- 긴 댓글은 기본 접기 상태로 표시해 스크롤 부담을 줄이고, 첨부 이미지는 라이트박스로 크게 볼 수 있습니다.

## 스토리 확인

<Canvas of={CommentThread} />
